# Firestore Setup for Event-Focused Social Media App

This document outlines the Firestore data structure and setup steps for the event-focused social media app.

## Firestore Data Structure

We'll use three main collections: `users`, `events`, and `posts`.

### 1. `users` Collection

This collection stores information about each user.

- **Document ID:** `uid` (from Firebase Authentication)
- **Fields:**
  - `displayName` (string): The user's display name.
  - `email` (string): The user's email address.
  - `photoURL` (string): The URL of the user's profile picture.
  - `createdAt` (timestamp): The timestamp when the user account was created.
  - `joinedEvents` (array of strings): An array of `eventId`s that the user has joined.

**Example `user` document:**
```json
{
  "displayName": "John Doe",
  "email": "john.doe@example.com",
  "photoURL": "https://example.com/profile.jpg",
  "createdAt": "2024-07-28T10:00:00Z",
  "joinedEvents": ["event123", "event456"]
}
```

### 2. `events` Collection

This collection stores information about each event.

- **Document ID:** A unique ID for each event (can be auto-generated by Firestore).
- **Fields:**
  - `name` (string): The name of the event.
  - `date` (timestamp): The date and time of the event.
  - `description` (string): A description of the event.
  - `coverImage` (string): The URL of the event's cover image (stored in Firebase Storage).
  - `createdBy` (string): The `uid` of the user who created the event.
  - `participants` (array of strings): An array of `uid`s of users who have joined the event.
  - `isPublic` (boolean): `true` if the event is public, `false` if it's private.
  - `joinCode` (string): A unique code to join the event (for private events).
  - `createdAt` (timestamp): The timestamp when the event was created.

**Example `event` document:**
```json
{
  "name": "Summer Music Festival",
  "date": "2024-08-15T18:00:00Z",
  "description": "A weekend of live music from top artists.",
  "coverImage": "https://example.com/event-cover.jpg",
  "createdBy": "user123",
  "participants": ["user123", "user456"],
  "isPublic": true,
  "joinCode": null,
  "createdAt": "2024-07-20T12:00:00Z"
}
```

### 3. `posts` Collection

This collection stores all the posts (photos and videos) for all events.

- **Document ID:** A unique ID for each post (can be auto-generated by Firestore).
- **Fields:**
  - `eventId` (string): The ID of the event this post belongs to.
  - `userId` (string): The `uid` of the user who created the post.
  - `mediaUrl` (string): The URL of the photo or video (stored in Firebase Storage).
  - `caption` (string): A caption for the post.
  - `createdAt` (timestamp): The timestamp when the post was created.

**Example `post` document:**
```json
{
  "eventId": "event123",
  "userId": "user456",
  "mediaUrl": "https://example.com/post-media.jpg",
  "caption": "Having a great time!",
  "createdAt": "2024-08-15T20:30:00Z"
}
```

## Firebase Setup Steps

1.  **Create a Firebase Project:**
    - Go to the [Firebase Console](https://console.firebase.google.com/).
    - Click "Add project" and follow the on-screen instructions.

2.  **Enable Firestore and Firebase Storage:**
    - In your Firebase project, go to the "Build" section in the left-hand menu.
    - Click on "Firestore Database" and create a new database.
    - Click on "Storage" and set it up.

3.  **Set up Firebase Authentication:**
    - Go to "Authentication" in the "Build" section.
    - Enable the "Google" and "Email/Password" sign-in methods.

4.  **Configure Firebase Security Rules:**
    - **Firestore Rules:** Go to the "Rules" tab in the Firestore section and paste the following rules:
      ```
      rules_version = '2';
      service cloud.firestore {
        match /databases/{database}/documents {
          // Users can read and write their own data
          match /users/{userId} {
            allow read, write: if request.auth.uid == userId;
          }

          // Events can be read by anyone if public, or by participants if private
          match /events/{eventId} {
            allow read: if resource.data.isPublic || request.auth.uid in resource.data.participants;
            allow create: if request.auth.uid != null;
            allow update: if request.auth.uid == resource.data.createdBy;
          }

          // Posts can be created by event participants and read by anyone who can read the event
          match /posts/{postId} {
            allow read: if exists(/databases/$(database)/documents/events/$(resource.data.eventId)) &&
                         (get(/databases/$(database)/documents/events/$(resource.data.eventId)).data.isPublic ||
                          request.auth.uid in get(/databases/$(database)/documents/events/$(resource.data.eventId)).data.participants);
            allow create: if request.auth.uid in get(/databases/$(database)/documents/events/$(request.resource.data.eventId)).data.participants;
          }
        }
      }
      ```
    - **Storage Rules:** Go to the "Rules" tab in the Storage section and paste the following rules:
      ```
      rules_version = '2';
      service firebase.storage {
        match /b/{bucket}/o {
          // Allow users to upload to their own folder
          match /users/{userId}/{allPaths=**} {
            allow write: if request.auth.uid == userId;
          }

          // Allow event creators to upload cover images
          match /events/{eventId}/{allPaths=**} {
            allow write: if request.auth.uid == get(/databases/(default)/documents/events/$(eventId)).data.createdBy;
          }

          // Allow event participants to upload posts
          match /posts/{eventId}/{userId}/{allPaths=**} {
            allow write: if request.auth.uid == userId &&
                         request.auth.uid in get(/databases/(default)/documents/events/$(eventId)).data.participants;
          }
        }
      }
      ```

## Code Integration

Here are some example functions to interact with Firestore:

```javascript
import { doc, setDoc, getDoc, collection, addDoc, serverTimestamp } from "firebase/firestore";
import { db } from "./firebaseConfig"; // Your Firebase config file

// Create a user document in Firestore after signup
const createUserDocument = async (user, displayName) => {
  const userRef = doc(db, "users", user.uid);
  const snapshot = await getDoc(userRef);

  if (!snapshot.exists()) {
    const {
      email,
      photoURL
    } = user;
    const createdAt = serverTimestamp();

    try {
      await setDoc(userRef, {
        displayName,
        email,
        photoURL,
        createdAt,
        joinedEvents: []
      });
    } catch (error) {
      console.error("Error creating user document", error);
    }
  }
};

// Create a new event
const createEvent = async (user, eventData) => {
  try {
    const docRef = await addDoc(collection(db, "events"), {
      ...eventData,
      createdBy: user.uid,
      participants: [user.uid],
      createdAt: serverTimestamp(),
    });
    console.log("Event created with ID: ", docRef.id);
  } catch (error) {
    console.error("Error creating event", error);
  }
};

// Add a new post to an event
const addPost = async (user, eventId, postData) => {
  try {
    await addDoc(collection(db, "posts"), {
      ...postData,
      userId: user.uid,
      eventId,
      createdAt: serverTimestamp(),
    });
    console.log("Post added successfully!");
  } catch (error) {
    console.error("Error adding post", error);
  }
};
```